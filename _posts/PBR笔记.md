# physically-Based Rendering 基于物理的渲染

## 前言

- pbr就一定效果好，效率低？
- pbr相对于blin phong的优劣势？

## 基础概念
- fresnel(菲涅尔反射) 光线从一种介质进入另一种介质的时候，一部分入射，一部分反射，且随着观察视角角度越小，反射强度越大，入射强度越小。

- irradiance(辐照度) 单位时间内到达单位面积的辐射能量，通俗地理解成单位时间到单位面积的光子数量。irradiance可以理解成单位面积内，所有光照到达它的总能量。

- radiance(辐射率)，单位面积每单位立体角的辐射能量。可以理解为眼睛看到的光的能量。与irradiance不同的是，这个是只有和该立体角平衡的入射光的能量，在计算机渲染中，radiance是用来表示颜色。

- Solid Angle（立体角 Ω)，物体对特定点的三维空间的角度，可以理解为单位球面上眼睛看到的一块面积。在渲染实现中，立体角更多是作为一个方向来使用，但反射方程中对立体角积分很多空间感理解不好的人来说，可以理解成对半球表面的积分就可以了。

- power(功率)，这个在brdf公式推导上要用到，如果不想去理解brdf数学模型，可以不管。

- GGX、Blinn-Phong、Cook-Torrance、Phong, 微表面法线分布函数。GGX能够直接在高光周围产生光晕，所以是现在的主流做法。

- relectance equation(反射方程) 
$$ L_o(v) = \int_\Omega { f(l,v) \bigotimes L_i(l)cos\theta_idw_i} $$ 

- $ \bigotimes $ 代表分量相乘
- $ f(l, v) $ 是 brdf 函数
- $ L_i $ 在立体角 $w_i$方向上的入射光

- lambert 漫反射方程

## PBR核心理论与渲染原理

- 微平面理论 (Microfacet Theory) 微平面理论是将物体表面建模成做无数微观尺度上有随机朝向的理想镜面反射的小平面 （microfacet）的理论。<b> 在实际的PBR 工作流中，这种物体表面的不规则性用粗糙度贴图或者高光度贴图来表示 </b>

- 能量守恒 (Energy Conservation) 出射光线的能量永远不能超过入射光线的能量。随着粗糙度的上升镜面反射区域的面积会增加，作为平衡，镜面反射区域的平均亮度则会下降。

- 菲涅尔反射 (Fresnel Reflectance) 光线以不同角度入射会有不同的反射率。相同的入射角度，不同的物质也会有不同的反射率。万物皆有菲涅尔反射。F0是即 0 度角入射的菲涅尔反射值。大多数非金属的F0范围是0.02~0.04，大多数金属的F0范围是0.7~1.0。

- 线性空间 (Linear Space) 光照计算必须在线性空间完成，shader 中输入的gamma空间的贴图比如漫反射贴图需要被转成线性空间，<b>描述物体表面属性的贴图如粗糙度，高光贴图，金属贴图等必须保证是线性空间。</b>

- 色调映射 (Tone Mapping) 也称色调复制(tone reproduction)，是将宽范围的照明级别拟合到屏幕有限色域内的过程。因为基于HDR渲染出来的亮度值会超过显示器能够显示最大亮度，所以需要使用色调映射，将光照结果从HDR转换为显示器能够正常显示的LDR。

- 物质的光学特性 (Substance Optical Properties) 现实世界中有不同类型的物质可分为三大类：绝缘体(Insulators)，半导体(semi-conductors)和导体(conductors)。在渲染和游戏领域，我们一般只对其中的两个感兴趣：导体（金属）和绝缘体（电解质，非金属）。其中非金属具有单色/灰色镜面反射颜色。而金属具有彩色的镜面反射颜色。即非金属的F0是一个float。而金属的F0是一个float3，如下图。

### 光与非光学平坦表面的交互原理
